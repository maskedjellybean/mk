(function(){config.pieces_per_row=3,config.pieces_count=null,config.row_count=null,config.pieces_per_row_zero=config.pieces_per_row-1,config.pieces_count_zero=null,config.row_count_zero=null,angular.module("portfolio").factory("rowsFactory",function($http,$q){delete $http.defaults.headers.common["X-Requested-With"];var target="http://fitbody.ben.dev/api/portfolio/mk/mk.jsonp?callback=JSON_CALLBACK",pieceTogglesSettings={transform:!1,backActive:!1,noFlipHelp:!1,notFlippable:!1,frontSwapped:!1,backSwapped:!1,showMoreActive:!1,fade:!1,hidePrimaryImg:!1,hideDescription:!1,hideBackNbrImg_0:!0,hideBackNbrImg_1:!0,hideBackNbrImg_2:!0,hideFrontNbrImg_0:!0,hideFrontNbrImg_1:!0,hideFrontNbrImg_2:!0},service={};return service.createRows=function(){var deferred=$q.defer();return $http({method:"JSONP",url:target}).success(function(data){config.pieces_count=data.portfolio.length,config.pieces_count_zero=config.pieces_count-1;for(var secondaryImages={},p=0;config.pieces_count>p;p++){for(var images=data.portfolio[p].images,b=0;images.length>b;b++)images[b]=images[b].src;secondaryImages["piece_"+[p]]=[];for(var i=0;images.length>i;i++)0===i?data.portfolio[p].primary_image=images[i]:secondaryImages["piece_"+[p]].push(images[i]);delete data.portfolio[p].images}for(p=0;config.pieces_count>p;p++)if(3===config.pieces_per_row){var mod=p%3;data.portfolio[p].neighbor_images=[];var neighbor1,neighbor2;0===mod?(data.portfolio[p].row_position="left",neighbor1=p+1,neighbor1="piece_"+(""+neighbor1),secondaryImages[neighbor1]!==void 0&&(neighbor1=secondaryImages[neighbor1][0],data.portfolio[p].neighbor_images.center=neighbor1),neighbor2=p+2,neighbor2="piece_"+(""+neighbor2),secondaryImages[neighbor2]!==void 0&&(neighbor2=secondaryImages[neighbor2][0],data.portfolio[p].neighbor_images.right=neighbor2)):1===mod?(data.portfolio[p].row_position="center",neighbor1=p-1,neighbor1="piece_"+(""+neighbor1),secondaryImages[neighbor1]!==void 0&&(neighbor1=secondaryImages[neighbor1][0],data.portfolio[p].neighbor_images.left=neighbor1),neighbor2=p+1,neighbor2="piece_"+(""+neighbor2),secondaryImages[neighbor2]!==void 0&&(neighbor2=secondaryImages[neighbor2][1],data.portfolio[p].neighbor_images.right=neighbor2)):2===mod&&(data.portfolio[p].row_position="right",neighbor1=p-1,neighbor1="piece_"+(""+neighbor1),secondaryImages[neighbor1]!==void 0&&(neighbor1=secondaryImages[neighbor1][1],data.portfolio[p].neighbor_images.center=neighbor1),neighbor2=p-2,neighbor2="piece_"+(""+neighbor2),secondaryImages[neighbor2]!==void 0&&(neighbor2=secondaryImages[neighbor2][1],data.portfolio[p].neighbor_images.left=neighbor2))}var pieceToggles=[];for(t=0;config.pieces_per_row>t;t++){pieceToggles[t]={};for(var property in pieceTogglesSettings)pieceToggles[t][property]=pieceTogglesSettings[property]}var rows={},rowCount=0;for(p=0;config.pieces_count>=p;p++)if(3===config.pieces_per_row){var rowTemp=data.portfolio.splice(0,3);rowTemp.length===config.pieces_per_row&&(rows["row_"+rowCount]=rowTemp,rows["row_"+rowCount].toggles=[],rows["row_"+rowCount].toggles=pieceToggles,rowCount++,config.pieces_count=config.pieces_count-3)}config.row_count=rowCount,config.row_count_zero=rowCount-1,console.log(rows,"rows factory"),deferred.resolve(rows)}).error(function(){deferred.reject()}),deferred.promise},service})})();